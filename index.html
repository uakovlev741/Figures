<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>three.js — Геометрические фигуры</title>
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #info {
        position: absolute;
        top: 10px;
        width: 100%;
        text-align: center;
        color: #000;
        font-family: sans-serif;
        font-size: 20px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="info">Трехмерные фигуры (перетаскивайте фигуры мышью)</div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://threejs.org/build/three.module.js"
        }
      }
    </script>

    <script type="module">
      import * as THREE from "three";
      import { OrbitControls } from "https://threejs.org/examples/jsm/controls/OrbitControls.js";
      import { EventControls } from 'https://alexan0308.github.io/threejs/examples/js/controls/EventControls.js';

      let camera, scene, renderer, controls, eventControl;
      const dragObjects = [];

      init();
      animate();

      function init() {
        const container = document.createElement("div");
        document.body.appendChild(container);

        // Камера
        camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          1,
          5000
        );
        camera.position.set(500, 600, 1200);

        // Освещение
        const ambientLight = new THREE.AmbientLight(0x555555);
        const light = new THREE.DirectionalLight(0xffffff, 1.0);
        light.position.set(1, 1, 1);

        // Рендерер
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Контролы
        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 500;
        controls.maxDistance = 2500;

        // Сцена
        scene = new THREE.Scene();
        scene.background = new THREE.Color("#CDF1FF");
        scene.add(ambientLight);
        scene.add(light);

        // === Геометрические фигуры ===

        // 1. Сфера
        let sphere = new THREE.Mesh(
          new THREE.SphereGeometry(100, 32, 32),
          new THREE.MeshPhongMaterial({ color: "blue" })
        );
        sphere.position.set(-400, 100, 0);
        scene.add(sphere);
        sphere.height = 100; // Добавляем высоту для корректного позиционирования
        dragObjects.push(sphere);

        // 2. Цилиндр
        let cylinder = new THREE.Mesh(
          new THREE.CylinderGeometry(80, 80, 200, 64),
          new THREE.MeshPhongMaterial({ color: "orange" })
        );
        cylinder.position.set(0, 50, 400);
        scene.add(cylinder);
        cylinder.height = 100;
        dragObjects.push(cylinder);

        // 3. Куб
        let cube = new THREE.Mesh(
          new THREE.BoxGeometry(160, 160, 160),
          new THREE.MeshPhongMaterial({ color: "green" })
        );
        cube.position.set(-150, 100, -300);
        scene.add(cube);
        cube.height = 80;
        dragObjects.push(cube);

        // Пирамида
        let pyramid = new THREE.Mesh(
          new THREE.ConeGeometry(100, 100, 4),
          new THREE.MeshPhongMaterial({ color: "lightgreen" })
        );
        pyramid.position.set(-400, 100, -400);
        scene.add(pyramid);
        pyramid.height = 100;
        dragObjects.push(pyramid);

        // Конус
        let cone = new THREE.Mesh(
          new THREE.ConeGeometry(100, 200, 32),
          new THREE.MeshPhongMaterial({ color: "#986C50" })
        );
        cone.position.set(200, 100, -300);
        scene.add(cone);
        cone.height = 100;
        dragObjects.push(cone);

        // Призма (треугольная)
        let prism = new THREE.Mesh(
          new THREE.CylinderGeometry(80, 80, 180, 3),
          new THREE.MeshPhongMaterial({ color: "#FF0000" })
        );
        prism.position.set(-150, 0, 200);
        prism.rotation.z = Math.PI / 2; // положена на бок
        prism.rotation.x = (Math.PI**(1/2)) / 4;
        scene.add(prism);
        prism.height = 50;
        dragObjects.push(prism);

        // Кубоид (прямоугольный параллелепипед)
        let cuboid = new THREE.Mesh(
          new THREE.BoxGeometry(100, 200, 100),
          new THREE.MeshPhongMaterial({ color: "#FFDD00" })
        );
        cuboid.position.set(400, 80, -400);
        scene.add(cuboid);
        cuboid.height = 50;
        dragObjects.push(cuboid);

        // Полусфера  
        let hemisphere = new THREE.Mesh(
          new THREE.SphereGeometry(100, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2),
          new THREE.MeshPhongMaterial({ color: "#FF00F4" })
        );
        hemisphere.position.set(400, 100, 400);
        scene.add(hemisphere);
        hemisphere.height = 0;
        dragObjects.push(hemisphere);

        // Сетка-помощник
        const helper = new THREE.GridHelper(1000, 10);
        scene.add(helper);

        // Создаем плоскость для перемещения объектов
        const planeGeometry = new THREE.PlaneGeometry(1200, 1200, 1, 1);
        const planeMaterial = new THREE.MeshPhongMaterial({ 
          color: 0xD3D3D3, 
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.3
        });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.position.y = -1;
        plane.rotation.x = Math.PI / 2;
        scene.add(plane);

        // Инициализация EventControls
        eventControl = new EventControls(dragObjects, camera, renderer.domElement);
        eventControl.setDraggable(render, true);
        eventControl.setMap(plane);
        eventControl.setOrbitControl(controls);

        // Обработчик события перетаскивания
        eventControl.attachEvent('dragAndDrop', function () {
          // Корректируем позицию после перетаскивания
          this.event.object.position.y = this.event.object.height;
          
          // Привязываем к сетке (опционально)
          this.event.object.position.x = 50 * Math.round(this.event.object.position.x / 50);
          this.event.object.position.z = 50 * Math.round(this.event.object.position.z / 50);
        });

        // Слушатель событий
        window.addEventListener("resize", onWindowResize);
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }

      function render() {
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>

